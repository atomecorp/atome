Opal.queue(function(Opal) {/* Generated by Opal 1.5.1 */
  var self = Opal.top, $nesting = [], $$ = Opal.$r($nesting), nil = Opal.nil, $hash2 = Opal.hash2, $send = Opal.send, $def = Opal.def, $truthy = Opal.truthy, $eqeq = Opal.eqeq, b = nil, c = nil, a = nil;

  Opal.add_stubs('box,height,left,smooth,touch,color,length,atomes,top,rotate,alert,puts,particle_creator,generate_headless_renderer,class,is_a?,instance_exec,to_proc,generate_html_renderer,==,remove_class,add_class,new,drag,shape,circle');
  
  b = self.$box($hash2(["width", "left", "id"], {"width": 333, "left": 666, "id": "poil"}));
  b.$height(33);
  b.$left(333);
  b.$smooth([33, 2, 90]);
  $send(b, 'touch', [true], function $$1(){var self = $$1.$$s == null ? this : $$1.$$s;

    return self.$color($hash2(["render", "id", "type", "red", "green", "blue", "alpha"], {"render": ["html"], "id": "color_" + ($$('Universe').$atomes().$length()), "type": "color", "red": 1, "green": 0.33, "blue": 0.22, "alpha": 1}))}, {$$arity: 0, $$s: self});
  c = b.$box($hash2(["left"], {"left": 333}));
  b.$top(99);
  $send(b, 'rotate', [999], function $$2(){var self = $$2.$$s == null ? this : $$2.$$s;

    return self.$alert("poilu")}, {$$arity: 0, $$s: self});
  
  $def(self, '$dragCallback', function $$dragCallback(page_x, page_y) {
    var self = this;

    return self.$puts("" + (page_x) + ":" + (page_y))
  }, 2);
  // target elements with the "draggable" class
interact('.draggable')
  .draggable({
    // enable inertial throwing
    inertia: true,
    // keep the element within the area of it's parent
    modifiers: [
      interact.modifiers.restrictRect({
        restriction: 'parent',
        endOnly: true
      })
    ],
    // enable autoScroll
    autoScroll: true,

    listeners: {
      // call this function on every dragmove event
      move: dragMoveListener,

      // call this function on every dragend event
      end (event) {
        var textEl = event.target.querySelector('p')

        textEl && (textEl.textContent =
          'moved a distance of ' +
          (Math.sqrt(Math.pow(event.pageX - event.x0, 2) +
                     Math.pow(event.pageY - event.y0, 2) | 0))
            .toFixed(2) + 'px')
      }
    }
  })

function dragMoveListener (event) {

  var target = event.target
  // keep the dragged position in the data-x/data-y attributes
  var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx
  var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy

  // translate the element
  target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'

  // update the posiion attributes
  target.setAttribute('data-x', x)
  target.setAttribute('data-y', y)
// CallBack here
  Opal.Atome.$dragCallback(event.pageX,event.pageY);
}
;
  $$('Genesis').$particle_creator("drag");
  $send($$('Genesis'), 'generate_headless_renderer', ["drag"], function $$3(value, atome, user_proc){var self = $$3.$$s == null ? this : $$3.$$s;

    
    
    if (value == null) value = nil;;
    
    if (atome == null) atome = nil;;
    
    if (user_proc == null) user_proc = nil;;
    self.$puts("msg from headless drag method: value is " + (value) + " , atome class is " + (atome.$class()));
    if ($truthy(user_proc['$is_a?']($$('Proc')))) {
      return $send(self, 'instance_exec', [], user_proc.$to_proc())
    } else {
      return nil
    };}, {$$arity: 3, $$s: self});
  $send($$('Genesis'), 'generate_html_renderer', ["drag"], function $$4(value, atome, user_proc){var self = $$4.$$s == null ? this : $$4.$$s;
    if (self.html_object == null) self.html_object = nil;

    
    
    if (value == null) value = nil;;
    
    if (atome == null) atome = nil;;
    
    if (user_proc == null) user_proc = nil;;
    if ($eqeq(value, "remove")) {
      self.html_object.$remove_class("draggable")
    } else {
      self.html_object.$add_class("draggable")
    };
    if ($truthy(user_proc['$is_a?']($$('Proc')))) {
      return $send(self, 'instance_exec', [], user_proc.$to_proc())
    } else {
      return nil
    };}, {$$arity: 3, $$s: self});
  a = $$('Atome').$new($hash2(["shape"], {"shape": $hash2(["render", "id", "type", "parent", "left", "right", "width", "height", "color"], {"render": ["html"], "id": "crasher", "type": "shape", "parent": "view", "left": 99, "right": 99, "width": 99, "height": 99, "color": $hash2(["render", "id", "type", "red", "green", "blue", "alpha"], {"render": ["html"], "id": "c315", "type": "color", "red": 1, "green": 0.15, "blue": 0.15, "alpha": 0.6})})}));
  $send(a.$shape(), 'drag', [true], function $$5(e){var self = $$5.$$s == null ? this : $$5.$$s;

    
    
    if (e == null) e = nil;;
    return self.$puts("drag_is_ok");}, {$$arity: 1, $$s: self});
  $send(a.$shape(), 'touch', [true], function $$6(){
    if ($eqeq(a.$shape().$drag(), "remove")) {
      return a.$shape().$drag(true)
    } else {
      return a.$shape().$drag("remove")
    }}, 0);
  c = self.$circle();
  self.$puts("------");
  c.$color("orange");
  c = self.$circle($hash2(["left"], {"left": 666}));
  c.$color($hash2(["render", "id", "type", "red", "green", "blue", "alpha"], {"render": ["html"], "id": "c3190", "type": "color", "red": 1, "green": 0.6, "blue": 0.15, "alpha": 0.6}));
  return c.$color("orange");
});
