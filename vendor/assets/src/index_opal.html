<!DOCTYPE html>
<html lang="En" id="html">
<head>
    <link rel="icon" type="image/x-icon"
          href="https://github.com/atomecorp/atome/blob/master/vendor/assets/src/favicon.ico">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover,user-scalable=no">
    <meta charset='UTF-8'/>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <link type="text/css" rel="stylesheet" href="css/style.css">
    <link type="text/css" rel="stylesheet" href="css/codemirror.min.css">
    <link type="text/css" rel="stylesheet" href="css/monokai.min.css">
    <link type="text/css" rel="stylesheet" href="css/leaflet.css">
    <style id="atomic_style"></style>
    <script type="text/javascript" src="js/third_parties/leaflet.js" defer></script>
    <script type="text/javascript" src="js/third_parties/interact.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/popmotion.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/sortable.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/wad.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/wavesurfer.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/webaudio-pianoroll.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/sha256.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/ping.min.js" defer></script>
    <script defer src="js/third_parties/fabric.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/third_parties/papaparse.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/codemirror.min.js" defer></script>
    <script type="text/javascript" src="js/third_parties/ruby.min.js" defer></script>    <script src='js/opal/opal.js' defer></script>
    <script src='js/opal/opal_parser.js' defer></script>
    <script src='js/aui.js' defer></script>
    <script defer src='js/host_mode.js'></script>
    <script src='js/opal/atome_opal_extensions.js' defer></script>
    <script src='js/atome/kernel.js' defer></script>
    <script defer src="js/atome/atome_helpers/communication.js" type="text/javascript"></script>
    <script defer src="js/atome/atome_helpers/file.js" type="text/javascript"></script>
    <title>atome</title>
</head>
<body id='user_view' class='atome'>
<div id='copyright'>Â©atome 2024</div>

<!---->

<!--<div id="container"></div>-->
<script type="importmap">
    {
        "imports": {
            "three": "./js/third_parties/Three/build/three.module.min.js",
            "three/addons/": "./js/third_parties/Three/jsm/"
        }
    }
</script>
<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    let camera, scene, renderer, controls;
    let hotspot;

    function initWithParam(path, target, method, params) {
        init(path, target, method, params);
        animate();
    }

    window.initWithParam = initWithParam;

    function init(path, target, method, params) {
        const container = document.getElementById(target);

        const width = container.clientWidth;
        const height = container.clientHeight;

        camera = new THREE.PerspectiveCamera(75, width / height, 1, 1100);
        camera.position.z = 0.01;

        scene = new THREE.Scene();

        const geometry = new THREE.SphereGeometry(500, 60, 40);
        geometry.scale(-1, 1, 1);

        const textureLoader = new THREE.TextureLoader();
        const texture = textureLoader.load(path);
        texture.colorSpace = THREE.SRGBColorSpace;
        const material = new THREE.MeshBasicMaterial({ map: texture });

        const mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        // Hotspot
        const hotspotGeometry = new THREE.SphereGeometry(2, 32, 16);
        const hotspotMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        hotspot = new THREE.Mesh(hotspotGeometry, hotspotMaterial);
        hotspot.position.set(5, 0, -50);
        scene.add(hotspot);

        // Event listener for the hotspot
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', (event) => {
            event.preventDefault();

            const rect = container.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects([hotspot]);

            if (intersects.length > 0) {
                alert(`Hotspot clicked! Three.js version: ${THREE.REVISION}, ${method}, ${params}`);
            }
        }, false);

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(width, height);
        renderer.setAnimationLoop(animate);
        container.appendChild(renderer.domElement);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableZoom = false;

        window.addEventListener('resize', onWindowResize);
    }

    function onWindowResize() {
        const container = document.getElementById('container');
        const width = container.clientWidth;
        const height = container.clientHeight;

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize(width, height);
    }

    function animate() {
        controls.update();
        renderer.render(scene, camera);
    }
</script>

<!---->
</body>
<script defer src="js/atome/specific/opal.js" type="text/javascript"></script>
<script type="text/javascript">
    const NativeMode = false; // used by atome.js to load code on the fly
</script>
<script defer src="js/atome/atome.js" type="text/javascript"></script>
<script src='js/application.js' defer></script>
<script>
    // to prevent right click
    document.addEventListener("contextmenu", function (e) {
        e.preventDefault();
    });
</script>
<script defer>
    document.addEventListener('touchstart', function (event) {
        if (event.touches.length > 1) {
            event.preventDefault();
        }
    }, {passive: false});
    document.addEventListener('wheel', function (event) {
        if (event.ctrlKey === true) {
            event.preventDefault(); // prevent zoom
        }
    }, {passive: false});
</script>
</html>
