!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:o[t]}function n(n){for(var a=0;a<n.length;a++){var o=n.charAt(a),c="'"+o+"'";l[c]||(l[c]=function(n){return function(a){return function(n,a){var o=r(n);if(!o||n.getOption("disableInput"))return e.Pass;var l=t(o,"pairs"),c=l.indexOf(a);if(-1==c)return e.Pass;for(var f,h=t(o,"closeBefore"),u=t(o,"triples"),d=l.charAt(c+1)==a,p=n.listSelections(),g=c%2==0,v=0;v<p.length;v++){var m,b=p[v],C=b.head,x=n.getRange(C,s(C.line,C.ch+1));if(g&&!b.empty())m="surround";else if(!d&&g||x!=a)if(d&&C.ch>1&&u.indexOf(a)>=0&&n.getRange(s(C.line,C.ch-2),C)==a+a){if(C.ch>2&&/\bstring/.test(n.getTokenTypeAt(s(C.line,C.ch-2))))return e.Pass;m="addFour"}else if(d){var P=0==C.ch?" ":n.getRange(s(C.line,C.ch-1),C);if(e.isWordChar(x)||P==a||e.isWordChar(P))return e.Pass;m="both"}else{if(!g||!(0===x.length||/\s/.test(x)||h.indexOf(x)>-1))return e.Pass;m="both"}else m=d&&function(e,t){var n=e.getTokenAt(s(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch&&(0==t.ch||!/\bstring/.test(e.getTokenTypeAt(t)))}(n,C)?"both":u.indexOf(a)>=0&&n.getRange(C,s(C.line,C.ch+3))==a+a+a?"skipThree":"skip";if(f){if(f!=m)return e.Pass}else f=m}var k=c%2?l.charAt(c-1):a,y=c%2?a:l.charAt(c+1);n.operation(function(){if("skip"==f)n.execCommand("goCharRight");else if("skipThree"==f)for(t=0;t<3;t++)n.execCommand("goCharRight");else if("surround"==f){for(var e=n.getSelections(),t=0;t<e.length;t++)e[t]=k+e[t]+y;n.replaceSelections(e,"around"),e=n.listSelections().slice();for(t=0;t<e.length;t++)e[t]=i(e[t]);n.setSelections(e)}else"both"==f?(n.replaceSelection(k+y,null),n.triggerElectric(k+y),n.execCommand("goCharLeft")):"addFour"==f&&(n.replaceSelection(k+k+k+k,"before"),n.execCommand("goCharRight"))})}(a,n)}}(o))}}function r(e){var t=e.state.closeBrackets;if(!t||t.override)return t;return e.getModeAt(e.getCursor()).closeBrackets||t}function i(t){var n=e.cmpPos(t.anchor,t.head)>0;return{anchor:new s(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new s(t.head.line,t.head.ch+(n?1:-1))}}function a(e,t){var n=e.getRange(s(t.line,t.ch-1),s(t.line,t.ch+1));return 2==n.length?n:null}var o={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},s=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,a){a&&a!=e.Init&&(r.removeKeyMap(l),r.state.closeBrackets=null),i&&(n(t(i,"pairs")),r.state.closeBrackets=i,r.addKeyMap(l))});var l={Backspace:function(n){var i=r(n);if(!i||n.getOption("disableInput"))return e.Pass;for(var o=t(i,"pairs"),l=n.listSelections(),c=0;c<l.length;c++){if(!l[c].empty())return e.Pass;var f=a(n,l[c].head);if(!f||o.indexOf(f)%2!=0)return e.Pass}for(c=l.length-1;c>=0;c--){var h=l[c].head;n.replaceRange("",s(h.line,h.ch-1),s(h.line,h.ch+1),"+delete")}},Enter:function(n){var i=r(n),o=i&&t(i,"explode");if(!o||n.getOption("disableInput"))return e.Pass;for(var s=n.listSelections(),l=0;l<s.length;l++){if(!s[l].empty())return e.Pass;var c=a(n,s[l].head);if(!c||o.indexOf(c)%2!=0)return e.Pass}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null),n.execCommand("goCharLeft"),s=n.listSelections();for(var t=0;t<s.length;t++){var r=s[t].head.line;n.indentLine(r,null,!0),n.indentLine(r+1,null,!0)}})}};n(o.pairs+"`")});